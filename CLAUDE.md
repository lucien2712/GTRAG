# Graph-based RAG 專案摘要

## 🎯 專案目標

建立一套基於圖結構的檢索增強生成（Graph-based RAG）系統，專門處理：
1. **跨檔案問題**：整合多個文檔的資訊進行推理
2. **時間序列問題**：分析不同時間點（如季度）的數據演變和趨勢

主要應用場景：**財報分析**，處理不同公司的季度財報文件。

## 🏗️ 系統架構

### **核心組件**

1. **LLMExtractor** - LLM 資訊萃取器
   - 使用 GPT-4 從文本中萃取實體和關係
   - 結構化輸出（JSON格式）
   - 包含置信度評估

2. **GraphBuilder** - 圖建構器  
   - 建立多層次圖結構
   - 管理季度子圖
   - 自動建立時間連接

3. **GraphRetriever** - 智能檢索器
   - 時間感知檢索
   - 智能多跳擴展
   - 語義搜尋

4. **GraphRAGSystem** - 完整系統
   - 端到端處理流程
   - 統一查詢介面

## 📊 知識圖譜設計

### **三層圖結構**

```
時間層：TIME_2024Q1 → TIME_2024Q2 → TIME_2024Q3 → TIME_2024Q4

實體層：同一季度內的實體關係網路
- Apple_2024Q1 --[ownership]--> iPhone_2024Q1
- iPhone_2024Q1 --[contribution]--> Revenue_Growth_2024Q1

跨時間層：同一實體的時間演變
- Apple_2024Q1 ===[temporal_evolution]===> Apple_2024Q2
- iPhone_2024Q1 ===[temporal_evolution]===> iPhone_2024Q2
```

## 🔍 智能檢索機制

### **1. 階層式檢索**
```
第一層：時間範圍篩選 → 選擇相關季度子圖
第二層：語義搜尋 → 在選定子圖中進行embedding相似度計算
第三層：結果排序 → 跨季度統一排序
```

### **2. 智能多跳擴展**

**鄰居重要性計算公式**：
```
總分數 = ......
```

**分層擴展策略**：
- 第1跳：從起始節點選擇前5個最重要鄰居
- 第2跳：從第1跳節點每個再選擇前5個重要鄰居  
- 第3跳：繼續擴展，自動過濾低重要性節點

### **3. 混合檢索模式**

- **時間感知檢索**：在指定季度範圍內搜尋
- **純語義檢索**：不限時間的全圖語義搜尋
- **混合檢索**：結合時間權重 + 語義權重
